<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ê²°ì œí•˜ê¸° - ì´ì§€ì‚¬ì£¼</title>

  <!-- âœ… ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

    :root {
      --primary-color: #4a5a73;
      --kakao-yellow: #FEE500;
      --naver-green: #03C75A;
      --toss-blue: #0064FF;
      --text-dark: #212529;
      --text-light: #6C757D;
      --bg-light: #f8f9fa;
      --border-color: #dee2e6;
    }

    body {
      margin: 0;
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
    }

    .wrapper {
      max-width: 480px;
      margin: 0 auto;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .08);
    }

    /* ìƒë‹¨ í—¤ë” */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: sticky;
      top: 0;
      z-index: 10;
      background: #fff;
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .header .back-btn {
      position: absolute;
      left: 1rem;
      font-size: 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
    }

    .header h1 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 500;
    }

    /* ë°°ë„ˆ */
    .banner {
      position: relative;
      height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 1rem;
      color: #fff;
      overflow: hidden;
    }

    .banner .bg-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }

    .banner::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, rgba(29,43,80,.7), rgba(44,62,80,.4));
      z-index: 2;
    }

    .banner .text-content {
      position: relative;
      z-index: 3;
    }

    .banner .subtitle {
      font-size: .9rem;
      opacity: .9;
    }

    .banner .title {
      font-size: 2.1rem;
      font-weight: 700;
      margin: .25rem 0;
    }

    .banner .desc {
      font-size: 1.2rem;
      opacity: .95;
    }

    main {
      padding: 1.5rem;
      background: var(--bg-light);
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .price-info {
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
      margin-bottom: .8rem;
    }

    .price-info.total {
      font-size: 1.2rem;
      font-weight: 700;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }

    .discount {
      display: inline-block;
      font-size: .75rem;
      font-weight: 700;
      color: #fff;
      background: #007bff;
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: .5rem;
    }

    /* ê²°ì œ ë²„íŠ¼ */
    .payment-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      margin-top: 1.5rem;
    }

    .sns-payment-group {
      display: flex;
      gap: 0.9rem;
      flex-wrap: wrap;
    }

    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: 0.9rem 1rem;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn-kakao { background: linear-gradient(145deg, #FFE870, #FDD835); color: #222; }
    .btn-naver { background: linear-gradient(145deg, #4ADE80, #16A34A); color: #fff; }
    .btn-card  { background: linear-gradient(145deg, #A3E9F0, #7DE1E8); color: #003f45; }

    footer {
      padding: 2rem 1rem;
      text-align: center;
      background: var(--bg-light);
    }

    .copyright { font-size: .75rem; color: #adb5bd; margin-top: 1rem; }
  </style>

  <!-- âœ… NICEPAY ê²°ì œ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="https://pay.nicepay.co.kr/v1/js/"></script>
</head>

<body>
  <div class="wrapper">
    <!-- í—¤ë” -->
    <header class="header">
      <button class="back-btn" onclick="history.back()">&lt;</button>
      <h1>ê²°ì œí•˜ê¸°</h1>
    </header>

    <!-- ë°°ë„ˆ -->
    <div class="banner">
      <img src="/images/card-individual.png" alt="ê²°ì œ ë°°ë„ˆ" class="bg-img" />
      <div class="text-content">
        <p class="subtitle">ë‹¹ì‹ ì˜ ìš´ëª…ì„ í’€ì–´ë‚´ëŠ” ê³³</p>
        <h2 class="title" id="hero-title">ì´ì§€ì‚¬ì£¼</h2>
        <p class="desc">ë³µì±„ ê²°ì œí•˜ê¸°</p>
      </div>
    </div>

    <!-- ë©”ì¸ -->
    <main>
      <div class="card">
        <h3 class="card-title">ê²°ì œ ê¸ˆì•¡</h3>

        <div class="price-info">
          <span id="pay-product-name">ìƒí’ˆëª…</span>
          <span id="pay-product-price">0ì›</span>
        </div>

        <div class="price-info">
          <span>í• ì¸ ì ìš© <span class="discount" id="discount-badge" style="display:none;">-30%</span></span>
          <span id="pay-discount">-0ì›</span>
        </div>

        <div class="price-info total">
          <span>ìµœì¢… ê²°ì œê¸ˆì•¡</span>
          <span id="pay-final-price">0ì›</span>
        </div>

        <!-- ê²°ì œ ë²„íŠ¼ -->
        <div class="payment-buttons">
          <div class="sns-payment-group">
            <button class="btn btn-kakao" onclick="requestPay('kakaopay')">ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ</button>
            <button class="btn btn-naver" onclick="requestPay('naverpay')">ë„¤ì´ë²„í˜ì´ ê²°ì œ</button>
          </div>
          <button class="btn btn-card" onclick="requestPay('card')">ì‹ ìš©ì¹´ë“œê²°ì œ</button>
        </div>
      </div>
    </main>

    <!-- í‘¸í„° -->
    <footer>
      <div>ìƒí˜¸ëª…: ì´ì§€ì‚¬ì£¼ | ëŒ€í‘œ: ì•ˆë¯¸ì • | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 550-64-00884</div>
      <div>í†µì‹ íŒë§¤ë²ˆí˜¸: ì œ2025-ê³ ì–‘ì¼ì‚°ë™-1332í˜¸ | ì „í™”: 010-2151-3949</div>
      <p class="copyright">Â© 2025 ì´ì§€ì‚¬ì£¼. All rights reserved.</p>
    </footer>
  </div>

  <!-- âœ… ê²°ì œ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    const API_BASE = "https://my-payment-server-test.vercel.app";
    const token = new URLSearchParams(location.search).get("token");

    let ORDER = null;

    // ğŸ”¸ í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ê¸°ë°˜ìœ¼ë¡œ ì£¼ë¬¸ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        if (!token) throw new Error("í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ê²°ì œ ë§í¬ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.");

        const res = await fetch(`${API_BASE}/api/pay/order-info?token=${encodeURIComponent(token)}`);
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || "ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

        ORDER = {
          orderId: data.orderId,
          goodsName: data.goodsName,
          amount: Number(data.amount)
        };

        // UI ë°˜ì˜
        document.getElementById("hero-title").textContent = `ì´ì§€ì‚¬ì£¼ - ${ORDER.goodsName}`;
        document.getElementById("pay-product-name").textContent = ORDER.goodsName;
        document.getElementById("pay-product-price").textContent = `${ORDER.amount.toLocaleString()}ì›`;
        document.getElementById("pay-final-price").textContent = `${ORDER.amount.toLocaleString()}ì›`;

      } catch (err) {
        console.error("âŒ ê²°ì œì •ë³´ ë¡œë“œ ì‹¤íŒ¨:", err);
        alert(err.message || "ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      }
    });

    // ğŸ”¸ ê²°ì œ ìš”ì²­
    function requestPay(type) {
      if (!ORDER) {
        alert("ì£¼ë¬¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        return;
      }

      if (type !== "card") {
        alert("ğŸ›  í˜„ì¬ ì¹´ë“œ ê²°ì œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }

      console.log("ğŸš€ ê²°ì œìš”ì²­ ë°ì´í„°:", ORDER);

      AUTHNICE.requestPay({
        clientId: "R2_29330d4bbbe14f5c85925e52e48e0721",
        method: "card",
        orderId: ORDER.orderId,  // âœ… form.jsì—ì„œ ë„˜ì–´ì˜¨ orderId ì‚¬ìš©
        amount: ORDER.amount,
        goodsName: ORDER.goodsName,
        returnUrl: `${API_BASE}/api/pay/callback`,
        fnError: err => {
          console.error("âŒ ì¸ì¦ ì˜¤ë¥˜:", err);
          alert("ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        },
        fnSuccess: res => console.log("âœ… ì¹´ë“œ ì¸ì¦ ì„±ê³µ:", res)
      });
    }
  </script>
</body>
</html>
